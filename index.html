<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì—¬í–‰ ì •ì‚° (ê³µìœ  ë²„ì „)</title>
  <style>
    body{font-family:sans-serif;background:#f9fafb;color:#111;margin:0;padding:20px}
    h1{margin-bottom:10px}
    label{display:block;margin-top:8px;font-size:14px}
    input,select,button{padding:6px 10px;margin-top:4px}
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{border:1px solid #ddd;padding:6px;text-align:left}
    th{background:#f1f5f9}
    .right{text-align:right}
  </style>
</head>
<body>
  <h1>ğŸ§® ì—¬í–‰ ì •ì‚° (Google Sheet ì—°ë™)</h1>

  <div>
    <label>ì¸ì›ìˆ˜</label>
    <select id="people"></select>

    <label>ìˆ™ë°•ì¼ìˆ˜</label>
    <select id="nights">
      <option value="1">1ë°•</option>
      <option value="2">2ë°•</option>
      <option value="3">3ë°•</option>
    </select>

    <label>ì—¬í–‰ ì‹œì‘ì¼</label>
    <input id="tripStart" type="date" />
  </div>

  <hr>

  <h2>ì§€ì¶œ í•­ëª© ì¶”ê°€</h2>
  <label>ë‚ ì§œ <input id="date" type="date"></label>
  <label>ì¥ì†Œ <input id="place" type="text"></label>
  <label>ë‚´ìš© <input id="desc" type="text"></label>
  <label>ê¸ˆì•¡ <input id="amount" type="number"></label>
  <label>ë¹„ê³  <input id="note" type="text"></label>
  <button id="addBtn">ì¶”ê°€</button>

  <h2>ë‚´ì—­</h2>
  <table>
    <thead>
      <tr><th>ë‚ ì§œ</th><th>ì¥ì†Œ</th><th>ë‚´ìš©</th><th class="right">ê¸ˆì•¡</th><th>ë¹„ê³ </th></tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyZtdeXB3U_xd5pEEEyUwipXpQOZdHIiRyvso3n4NwpaL5u1EPVVGs-CaXQmWRYrwMoqQ/exec';

// ë“œë¡­ë‹¤ìš´ ì¸ì›ìˆ˜ ì˜µì…˜ ìƒì„±
const peopleSelect = document.querySelector('#people');
peopleSelect.innerHTML = Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}ëª…</option>`).join('');

async function fetchItems(){
  const res = await fetch(API_URL);
  return await res.json();
}

async function postItem(item){
  await fetch(API_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(item)
  });
}

function formatMoney(n){ return Number(n||0).toLocaleString('ko-KR'); }

async function render(){
  const items = await fetchItems();
  const tbody = document.querySelector('#list');
  if(!items.length){ tbody.innerHTML = '<tr><td colspan="5">ë°ì´í„° ì—†ìŒ</td></tr>'; return; }
  tbody.innerHTML = items.map(r=>`
    <tr>
      <td>${r.date}</td>
      <td>${r.place||''}</td>
      <td>${r.desc}</td>
      <td class="right">${formatMoney(r.amount)}</td>
      <td>${r.note||''}</td>
    </tr>`).join('');
}

async function addItem(){
  const date = document.querySelector('#date').value;
  const place = document.querySelector('#place').value;
  const desc = document.querySelector('#desc').value;
  const amount = Number(document.querySelector('#amount').value||0);
  const note = document.querySelector('#note').value;
  if(!date || !desc || !amount){ alert('ë‚ ì§œ/ë‚´ìš©/ê¸ˆì•¡ í•„ìˆ˜'); return; }
  await postItem({date, place, desc, amount, note});
  document.querySelector('#desc').value='';
  document.querySelector('#amount').value='';
  document.querySelector('#note').value='';
  await render();
}

document.querySelector('#addBtn').addEventListener('click', addItem);

render();
</script>
</body>
</html>
