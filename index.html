<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì—¬í–‰ ì •ì‚°</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --muted:#6b7280; --txt:#e5e7eb; --accent:#22c55e; --danger:#ef4444; }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    body{margin:0;background:linear-gradient(120deg,#0b1022,#0f172a 60%);color:var(--txt)}
    .wrap{max-width:1000px;margin:24px auto;padding:16px}
    .card{background:rgba(17,24,39,.85);border:1px solid #1f2937;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.35);padding:16px}
    h1{margin:0 0 8px;font-size:28px}
    h2{margin:12px 0 8px;font-size:18px;color:#cbd5e1}
    label{font-size:13px;color:#cbd5e1}
    input,select,button,textarea{background:#0b1220;border:1px solid #253041;color:var(--txt);padding:10px;border-radius:10px}
    input[type="number"]{text-align:right}
    button{cursor:pointer}
    button.primary{background:var(--accent);border-color:#16a34a;color:#04210f;font-weight:700}
    button.ghost{background:transparent;border-color:#334155}
    button.danger{background:var(--danger);border-color:#b91c1c;color:#200}
    .grid{display:grid;gap:12px}
    .g2{grid-template-columns:repeat(2,1fr)}
    .g3{grid-template-columns:repeat(3,1fr)}
    .g4{grid-template-columns:repeat(4,1fr)}
    .row{display:flex;gap:10px;align-items:end;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:12px}
    .kpi{display:flex;gap:12px;flex-wrap:wrap}
    .kpi > div{flex:1;min-width:180px;background:#0b1220;border:1px solid #1e293b;border-radius:12px;padding:12px}
    .kpi strong{font-size:20px}
    .group{margin:12px 0;border-left:3px solid #334155;padding-left:10px}
    .pill{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:4px 8px;border-radius:999px;background:#0b1220;border:1px solid #334155}
    table{width:100%;border-collapse:collapse;margin-top:6px}
    th,td{border-bottom:1px solid #1f2937;padding:8px;text-align:left}
    th{color:#cbd5e1;font-weight:600}
    .right{text-align:right}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .sep{height:1px;background:#1f2937;margin:14px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸ§® ì—¬í–‰ ì •ì‚°</h1>
      <p class="muted">GitHub Pages Â· Netlifyì— ì˜¬ë¦¬ê¸° ì‰¬ìš´ <b>ìˆœìˆ˜ HTML/JS</b> ë²„ì „ì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì € <b>localStorage</b>ì— ì €ì¥ë©ë‹ˆë‹¤.</p>

      <h2>â‘  ê¸°ë³¸ ì„¤ì •</h2>
      <div class="grid g4">
        <div>
          <label>ì¸ì›ìˆ˜ (ìµœëŒ€ 10ì¸)</label>
          <select id="people"></select>
        </div>
        <div>
          <label>ìˆ™ë°•ì¼ìˆ˜</label>
          <select id="nights">
            <option value="1">1ë°•</option>
            <option value="2">2ë°•</option>
            <option value="3">3ë°•</option>
          </select>
        </div>
        <div>
          <label>ì—¬í–‰ ì‹œì‘ì¼</label>
          <input id="tripStart" type="date" />
        </div>
        <div>
          <label>ì—¬í–‰ ì œëª©</label>
          <input id="tripTitle" type="text" placeholder="ì˜ˆ) 9ì›” ì œì£¼ ê°€ì¡±ì—¬í–‰" />
        </div>
      </div>

      <div class="sep"></div>
      <h2>â‘¡ ì§€ì¶œ í•­ëª© ì¶”ê°€</h2>
      <div class="row">
        <div style="flex:1 1 140px">
          <label>ë‚ ì§œ</label>
          <input id="date" type="date" />
        </div>
        <div style="flex:1 1 160px">
          <label>ì¥ì†Œ</label>
          <input id="place" type="text" placeholder="ì˜ˆ) ì„œê·€í¬, ê´‘ì•ˆë¦¬" />
        </div>
        <div style="flex:2 1 220px">
          <label>ë‚´ìš©</label>
          <input id="desc" type="text" placeholder="ì˜ˆ) ì ì‹¬, ìˆ™ë°•, ì£¼ìœ " />
        </div>
        <div style="flex:1 1 140px">
          <label>ê¸ˆì•¡(ì›)</label>
          <input id="amount" type="number" min="0" step="1" placeholder="0" />
        </div>
        <div style="flex:1 1 220px">
          <label>ë¹„ê³ </label>
          <input id="note" type="text" placeholder="ì„ ê²°ì œ/í˜„ê¸ˆ ë“±" />
        </div>
        <div>
          <button class="primary" id="addBtn">í•­ëª© ì¶”ê°€</button>
        </div>
      </div>

      <div class="sep"></div>
      <div class="kpi">
        <div><div class="muted">ì´ ì§€ì¶œ</div><strong id="sumTotal">0</strong><div class="muted">ì›</div></div>
        <div><div class="muted">1ì¸ë‹¹ ë¶€ë‹´</div><strong id="perHead">0</strong><div class="muted">ì›</div></div>
        <div><div class="muted">í•­ëª© ìˆ˜</div><strong id="itemCount">0</strong><div class="muted">ê±´</div></div>
      </div>

      <div class="sep"></div>
      <div class="controls">
        <button class="ghost" id="exportBtn">ë‚´ë³´ë‚´ê¸°(JSON)</button>
        <label class="pill" style="cursor:pointer">ê°€ì ¸ì˜¤ê¸°<input id="importFile" type="file" accept="application/json" style="display:none"></label>
        <button class="danger" id="clearBtn">ì „ì²´ ì´ˆê¸°í™”</button>
        <span class="muted" id="saveHint">ìë™ ì €ì¥ë¨</span>
      </div>

      <div class="sep"></div>
      <h2>â‘¢ ë‚´ì—­</h2>
      <div id="list"></div>
    </div>
  </div>

<script>
const $ = (sel)=>document.querySelector(sel);
const key = 'trip-settle-v1';

const state = {
  settings: { people: 2, nights: 1, tripStart: '', tripTitle: '' },
  items: [] // {id,date,place,desc,amount,note}
};

function load(){
  const raw = localStorage.getItem(key);
  if(!raw) return;
  try{
    const data = JSON.parse(raw);
    if(data.settings) state.settings = data.settings;
    if(Array.isArray(data.items)) state.items = data.items;
  }catch(e){ console.warn('load error', e); }
}

function save(){
  localStorage.setItem(key, JSON.stringify(state));
}

function formatMoney(n){
  return Number(n||0).toLocaleString('ko-KR');
}

function initUI(){
  // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ë™ì  ìƒì„±
  $('#people').innerHTML = Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}ëª…</option>`).join('');
  // settings
  $('#people').value = state.settings.people;
  $('#nights').value = state.settings.nights;
  $('#tripStart').value = state.settings.tripStart || '';
  $('#tripTitle').value = state.settings.tripTitle || '';

  ['people','nights','tripStart','tripTitle'].forEach(id=>{
    $('#'+id).addEventListener('change',e=>{
      const v = (id==='people'||id==='nights') ? Number(e.target.value) : e.target.value;
      state.settings[id] = v; save(); render();
    })
  })

  // default date
  const today = new Date().toISOString().slice(0,10);
  $('#date').value = today;

  $('#addBtn').addEventListener('click', addItem);
  $('#exportBtn').addEventListener('click', exportJSON);
  $('#importFile').addEventListener('change', importJSON);
  $('#clearBtn').addEventListener('click', clearAll);

  render();
}

function addItem(){
  const date = $('#date').value;
  const place = $('#place').value.trim();
  const desc = $('#desc').value.trim();
  const amount = Number($('#amount').value||0);
  const note = $('#note').value.trim();
  if(!date || !desc || !amount){
    alert('ë‚ ì§œ, ë‚´ìš©, ê¸ˆì•¡ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
    return;
  }
  state.items.push({
    id: crypto.randomUUID(),
    date, place, desc, amount, note,
    createdAt: Date.now()
  });
  save();
  // clear minimal
  $('#desc').value=''; $('#amount').value=''; $('#note').value='';
  render();
}

function deleteItem(id){
  state.items = state.items.filter(it=>it.id!==id);
  save(); render();
}

function exportJSON(){
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const title = state.settings.tripTitle || 'trip';
  a.href = url; a.download = `${title}-ì •ì‚°.json`;
  a.click(); URL.revokeObjectURL(url);
}

function importJSON(e){
  const file = e.target.files?.[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try{ const data = JSON.parse(reader.result);
      if(data.settings) state.settings = data.settings;
      if(Array.isArray(data.items)) state.items = data.items;
      save(); render();
    }catch(err){ alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
  };
  reader.readAsText(file);
}

function clearAll(){
  if(!confirm('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í• ê¹Œìš”?')) return;
  state.settings = { people: 2, nights: 1, tripStart: '', tripTitle: '' };
  state.items = [];
  save(); render();
}

function groupByDatePlace(items){
  const map = new Map();
  items.forEach(it=>{
    const key = `${it.date}__${it.place||''}`;
    if(!map.has(key)) map.set(key, { date: it.date, place: it.place||'', rows: [], sum:0 });
    const g = map.get(key);
    g.rows.push(it); g.sum += it.amount;
  });
  // sort by date asc, then createdAt
  return Array.from(map.values()).sort((a,b)=> a.date.localeCompare(b.date));
}

function render(){
  // KPIs
  const people = Number(state.settings.people)||1;
  const total = state.items.reduce((s,it)=>s+Number(it.amount||0),0);
  $('#sumTotal').textContent = formatMoney(total);
  $('#perHead').textContent = formatMoney(Math.round(total/people));
  $('#itemCount').textContent = state.items.length;

  // List
  const groups = groupByDatePlace(state.items);
  const $list = $('#list');
  if(groups.length===0){ $list.innerHTML = '<p class="muted">ì•„ì§ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ í•­ëª©ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</p>'; return; }

  $list.innerHTML = groups.map(g=>{
    const header = `
      <div class="group">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
          <div>
            <span class="pill">ğŸ“… ${g.date}</span>
            ${g.place?`<span class="pill">ğŸ“ ${g.place}</span>`:''}
          </div>
          <div class="pill">ê·¸ë£¹ í•©ê³„: <b>${formatMoney(g.sum)}</b>ì› Â· 1ì¸ <b>${formatMoney(Math.round(g.sum/people))}</b>ì›</div>
        </div>
        <table>
          <thead>
            <tr>
              <th style="width:38%">ë‚´ìš©</th>
              <th class="right" style="width:14%">ê¸ˆì•¡</th>
              <th class="right" style="width:14%">1ì¸ ì •ì‚°</th>
              <th style="width:24%">ë¹„ê³ </th>
              <th style="width:10%"></th>
            </tr>
          </thead>
          <tbody>
            ${g.rows.map(r=>`
              <tr>
                <td>${escapeHtml(r.desc)}</td>
                <td class="right">${formatMoney(r.amount)}</td>
                <td class="right">${formatMoney(Math.round(r.amount/people))}</td>
                <td>${escapeHtml(r.note||'')}</td>
                <td><button class="ghost" onclick="deleteItem('${r.id}')">ì‚­ì œ</button></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>`;
    return header;
  }).join('');
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, (c)=>({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
  })[c]);
}

// Boot
load();
window.addEventListener('DOMContentLoaded', initUI);
</script>
</body>
</html>
