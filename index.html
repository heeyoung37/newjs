<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>여행 정산 (공유 버전)</title>
  <style>
    body{font-family:sans-serif;background:#f9fafb;color:#111;margin:0;padding:20px}
    h1{margin-bottom:10px}
    label{display:block;margin-top:8px;font-size:14px}
    input,select,button{padding:6px 10px;margin-top:4px}
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{border:1px solid #ddd;padding:6px;text-align:left}
    th{background:#f1f5f9}
    .right{text-align:right}
  </style>
</head>
<body>
  <h1>🧮 여행 정산 (Google Sheet 연동)</h1>

  <div>
    <label>인원수</label>
    <select id="people"></select>

    <label>숙박일수</label>
    <select id="nights">
      <option value="1">1박</option>
      <option value="2">2박</option>
      <option value="3">3박</option>
    </select>

    <label>여행 시작일</label>
    <input id="tripStart" type="date" />
  </div>

  <hr>

  <h2>지출 항목 추가</h2>
  <label>날짜 <input id="date" type="date"></label>
  <label>장소 <input id="place" type="text"></label>
  <label>내용 <input id="desc" type="text"></label>
  <label>금액 <input id="amount" type="number"></label>
  <label>비고 <input id="note" type="text"></label>
  <button id="addBtn">추가</button>

  <h2>내역</h2>
  <table>
    <thead>
      <tr><th>날짜</th><th>장소</th><th>내용</th><th class="right">금액</th><th>비고</th></tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyZtdeXB3U_xd5pEEEyUwipXpQOZdHIiRyvso3n4NwpaL5u1EPVVGs-CaXQmWRYrwMoqQ/exec';

// 드롭다운 인원수 옵션 생성
const peopleSelect = document.querySelector('#people');
peopleSelect.innerHTML = Array.from({length:10},(_,i)=>`<option value="${i+1}">${i+1}명</option>`).join('');

async function fetchItems(){
  const res = await fetch(API_URL);
  return await res.json();
}

async function postItem(item){
  await fetch(API_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(item)
  });
}

function formatMoney(n){ return Number(n||0).toLocaleString('ko-KR'); }

async function render(){
  const items = await fetchItems();
  const tbody = document.querySelector('#list');
  if(!items.length){ tbody.innerHTML = '<tr><td colspan="5">데이터 없음</td></tr>'; return; }
  tbody.innerHTML = items.map(r=>`
    <tr>
      <td>${r.date}</td>
      <td>${r.place||''}</td>
      <td>${r.desc}</td>
      <td class="right">${formatMoney(r.amount)}</td>
      <td>${r.note||''}</td>
    </tr>`).join('');
}

async function addItem(){
  const date = document.querySelector('#date').value;
  const place = document.querySelector('#place').value;
  const desc = document.querySelector('#desc').value;
  const amount = Number(document.querySelector('#amount').value||0);
  const note = document.querySelector('#note').value;
  if(!date || !desc || !amount){ alert('날짜/내용/금액 필수'); return; }
  await postItem({date, place, desc, amount, note});
  document.querySelector('#desc').value='';
  document.querySelector('#amount').value='';
  document.querySelector('#note').value='';
  await render();
}

document.querySelector('#addBtn').addEventListener('click', addItem);

render();
</script>
</body>
</html>
